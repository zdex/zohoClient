<div class="upload-wrapper">

  <h2>Upload Transactions Sheet</h2>

  <!-- Upload Button -->
  <label class="upload-btn">
    Choose Excel File
    <input
      #fileInput
      type="file"
      accept=".xlsx"
      hidden
      (change)="onFileSelected($event, fileInput)">
  </label>

  <p *ngIf="fileName">Selected: {{ fileName }}</p>

  <!-- Loading -->
  <p *ngIf="loading">Loading previewâ€¦</p>
  <p class="error" *ngIf="error">{{ error }}</p>

  <!-- ================= PREVIEW ================= -->
  <div *ngIf="previewMode">

    <h3>Preview Transactions</h3>
    <p>Select rows to convert into invoices.</p>

    <table>
      <thead>
        <tr>
          <th>Select</th>
          <th>Row</th>
          <th>Customer</th>
          <th>Reference</th>
          <th>Amount</th>
          <th>Description</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let row of pagedData">
          <td>
            <input
              type="checkbox"
              [checked]="isSelected(row)"
              (change)="toggleRow(row)"
              [disabled]="row.duplicate">
          </td>

          <td>{{ row.row }}</td>

          <td [class.duplicate]="row.duplicate">
            {{ row.customerName }}
          </td>

          <td>{{ row.referenceNumber }}</td>

          <td>{{ row.amount | number:'1.2-2' }}</td>

          <td>{{ row.description }}</td>
        </tr>
      </tbody>
    </table>

    <!-- ================= PAGINATION ================= -->
    <div class="pagination">
      <button (click)="prevPage()" [disabled]="page === 1">
        Prev
      </button>

      <span>
        Page {{ page }} of {{ totalPages }}
      </span>

      <button
        (click)="nextPage()"
        [disabled]="page * pageSize >= previewData.length">
        Next
      </button>
    </div>

    <!-- ================= ACTIONS ================= -->
    <div class="actions">
      <button (click)="selectAllVisible()">
        Select Page
      </button>

      <button (click)="clearSelection()">
        Clear Selection
      </button>

      <button
        class="process-btn"
        (click)="processSelected()"
        [disabled]="loading || selectedRows.size === 0">
        Create Invoices ({{ selectedRows.size }})
      </button>
    </div>

  </div>
</div>
